---
title: StatefulSet
sidebar_label: statefulSet
sidebar_position: 3
description: Configuration for ...
---

import ControlPlaneStatefulSet from '@site/docs/_partials/config/controlPlane/statefulSet.mdx'

- The vCluster control plane is deployed as a `StatefulSet` since it typically requires a persistent volume to store data across restarts.
- If neither persistence option is enabled (no `persistence.volumeClaimTemplates` or `persistence.volumeClaim.enabled` == false), a `Deployment` will be used instead.

`highAvailability`:
- These settings allow for running more than one pod for the virtual cluster control plane, with one running as the leader
- If the leader crashes, is unhealthy, or restarts, there will be more pods ready to take over leadership, depending on the replicas
- adjusting the leaseDuration / renewDeadline / retryPeriod changes the leader election behavior (how often a leader is renewed & retries when it cannot be renewed)

`scheduling`:
- Controls various scheduler behavior for different purposes. Examples of each follow:
- `nodeSelector`: matches labels on nodes to make the scheduler "prefer" scheduling the vCluster pods on certain nodes. This can be done to:
  - target nodes in a region
  - target a specific architecture or machine class
- `affinity`: Can be affinity (attract the pod) or anti-affinity (repel the pod). Some use cases:
  - use anti-affinity to spread pods away from each other. A common technique is to make vCluster pods repel each other so that they are not scheduled on the same nodes. This increases resiliency in the event a node is scaled down or replaced by a cloud provider.
  - use affinity to group certain pods together to reduce network latency for critical services
- `tolerations`: Another method of influencing where the scheduler places pods. A common use for vCluster is to "taint" nodes for non-vCluster work loads, and make vCluster workloads "tolerate" the taint. This will result in separating critical applications from the more ephemeral vClusters
- `priorityClassName`: https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/
- `podManagementPolicy`: https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#pod-management-policies
- `topologySpreadConstraints`: https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/
  - Similar to podAffinity & podAntiAffinity in some ways: https://kubernetes.io/docs/concepts/scheduling-eviction/topology-spread-constraints/#comparison-with-podaffinity-podantiaffinity

## Config reference

<ControlPlaneStatefulSet/>