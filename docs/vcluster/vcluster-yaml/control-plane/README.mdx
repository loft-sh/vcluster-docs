---
title: Control Plane
sidebar_label: controlPlane
sidebar_position: 6
description: Configuration for ...
---

import ControlPlane from '@site/docs/_partials/config/controlPlane.mdx'


## Distributions (`distro`)
- previous docs: https://www.vcluster.com/docs/architecture/control_plane/k8s_distros
  - The separate helm charts for each distribution no longer applies
- Typically each distribution has advantages & disadvantages:
  - k3s: lightweight, simplified, can use sqllite as it's backing store
    - previously the default
  - k0s: lightweight, but more robust uses Kine as an abstraction for its backing store, uses etcd by default, but can also use mysql, postgresql, sqlite, and dqlite
  - k8s: vanilla kubernetes, complete feature set, better cloud provider support
    - new default distribution
- Compatibility matrix: https://www.vcluster.com/docs/deploying-vclusters/compat-matrix

## Backing Store (`backingStore`)
- Each distribution requires a data store.
- previous docs: https://www.vcluster.com/docs/deploying-vclusters/persistence#embedded-sqlite-without-persistent-volume
- This is why the vCluster pod is deployed using a StatefulSet (set of pod replicas + persistent volume (disk)) instead of a deployment (set of pod replicas)
- k8s & k0s use [Kine](https://github.com/k3s-io/kine) when deployed with the vCluster chart
- `database`: defined options when using a sql database as the data store for the vCluster control plane
  - `embedded`: use sqlite as the datastore
    - in its simplest form, this uses a file on a persistent volume for store
    - the persistent volume can be turned off. This is an even lighter weight option for testing, where losing data on restarts is acceptable
    - `migrateFromDeployedEtcd`: configure vCluster to migrate existing data from an external etcd to the sql database
  - `external`: use an external SQL database as the data store. Will be connected to the kubernetes distribution via [Kine](https://github.com/k3s-io/kine)
    - `dataSource`: the datastore endpoint to use
    - `keyFile`, `certFile`, `caFile`: certificate files to use for securely connecting to the `dataSource`. These correspond to the environment variables defined [here](https://www.vcluster.com/docs/deploying-vclusters/persistence#datastore-options)
- `etcd`: use an etcd instance for a backing store.
  - `embedded`: pro feature where etcd is deployed with vcluster to reduce the overall footprint while still providing the advantages of etcd.
    - `migrateFromDeployedEtcd`: configure vCluster to migrate existing data from an external etcd to the embedded etcd
  - `deploy`: describes the deployment of the external etcd
    - `statefulSet.*`: subset of configuration needed for the etcd `StatefulSet` deployment (these are mostly based on `StatefulSet` spec)
    - `service.annotations`: extra annotations to add to the etcd `Service`
    - `headlessService.annotations`: extra annotations to add to the etcd headless `Service`
- Why use a Database vs Etcd?
  - Database is lighter weight and for smaller clusters that do not require high availability
  - Etcd has better performance and supports high availability

## Config reference

<ControlPlane />