---
title: Resolve DNS
sidebar_label: resolveDNS
sidebar_class_name: pro
sidebar_position: 2
---

import ResolveDNS from '@site/docs/_partials/config/networking/resolveDNS.mdx'


[comment]: # (https://www.vcluster.com/pro/docs/features/cross_vcluster_coredns_plugin)

This feature enables adding custom DNS rules to the virtual cluster to allow communication with services deployed in the host cluster and across services in separate vCluster instances.


## Examples

### Mapping an FQDN

This is purely a url `mode` based mapping – mapping one `fqdn` inside the virtual cluster to another `fqdn`.
Hence dns lookups of `wikipedia.com` would return a DNS response with answer as `en.wikipedia.org`.

```yaml
networking:
  resolveServices:
    service: wikipedia
    target:
      vcluster:
        service:
      host:
        service:
      external:
        hostname: en.wikipedia.org
```

### Mapping service to host cluster service

This example maps `my-namespace/my-svc` inside the virtual cluster to `dns-test/nginx-svc` in the host cluster.  In this case, the DNS response is the service IP of the `nginx-svc` in the `dns-test` namespace of the host cluster.

```yaml
networking:
  resolveServices:
    service: my-namespace/my-svc
    target:
      vcluster:
        service:
      host:
        service: dns-test/nginx-svc
      external:
        hostname:
```

### Mapping services across vCluster instances

Mapping a service inside virtual cluster to another service in a separate virtual cluster
```yaml
coredns:
  integrated: true
  plugin:
    enabled: true
    config:
      - record:
          service: my-ns-in-vcluster/my-svc-vcluster
        target:
          mode: vcluster
          vcluster: test-vcluster-ns/test-vcluster
          service: dns-test-in-vcluster-ns/test-in-vcluster-service
```

In this case, as specified with `mode: vcluster` – the target service is in another vcluster.
Here the service `my-ns-in-vcluster/my-svc-vcluster` is mapped to  `dns-test-in-vcluster-ns/test-in-vcluster-service` in
a vcluster named `test-vcluster` deployed in namespace `test-vcluster-ns`.


```yaml
networking:
  resolveServices:
    service: my-ns-in-vcluster/my-svc-vcluster
    target:
      vcluster: test-vcluster-ns/test-vcluster
        service: dns-test-in-vcluster-ns/test-in-vcluster-service
      host:
        service:
      external:
        hostname:
```

### Mapping with service aliasing

Mapping a service in the same vCluster instance but under a different alias
```yaml
coredns:
  integrated: true
  plugin:
    enabled: true
    config:
      - record:
          service: my-self-vc-ns/my-self-vc-svc
        target:
          mode: self
          service: dns-test/nginx-svc
```
In this case the service `my-self-vc-ns/my-self-vc-svc` is mapped to `dns-test/nginx-svc` from the same vcluster itself.


```yaml
networking:
  resolveServices:
    service: my-self-vc-ns/my-self-vc-svc
    target:
      vcluster: self
        service: dns-test/nginx-svc
      host:
        service:
      external:
        hostname:
```

### Mapping whole namespaces

Mapping all services under a particular namespace under another namespace in vcluster
```yaml
coredns:
  integrated: true
  plugin:
    enabled: true
    config:
      - record:
          namespace: external-vc-ns
        target:
          mode: vcluster
          vcluster: test-vcluster-ns/test-vcluster
          namespace: test-in-vcluster-ns
```

Here, all services in the target namespace `test-in-vcluster-ns` of the vcluster `test-vcluster` are mapped inside a namespace
`external-vc-ns`.
One can visualize it as:
```
    ┌──────────────────────┐┌──────────────────────────────┐
    │nginx.external-vc-ns  ││nginx.test-in-vcluster-ns     │
    │svcA.external-vc-ns   ││svcA.test-in-vcluster-ns      │
    │svcB.external-vc-ns   ││svcB.test-in-vcluster-ns      │
    │...                   ││...                           │
    └──────────────────────┘└──────────────────────────────┘

```

The same is possible under the `mode: host` as well.


```yaml
networking:
  resolveServices:
    service: external-vc-ns
    target:
      vcluster: test-vcluster-ns/test-vcluster
        service: test-in-vcluster-ns
      host:
        service:
      external:
        hostname:
```

## Config reference

<ResolveDNS/>
