import Flow, { Step } from '@site/src/components/Flow'
import NavStep from '@site/src/components/NavStep'
import Button from '@site/src/components/Button'
import Label from '@site/src/components/Label'
import Input from '@site/src/components/Input'
import Expander from '@site/src/components/Expander'

<Flow id="upgrade-cluster-helm">
    <Step>
        If you prefer to use Helm, ensure that you have a valid access key. You can only obtain an access key after the cluster has been connected to the Platform.
    </Step>
    <Step>
        To retrieve the access key for a connected cluster, run:
        ```bash
        vcluster platform get cluster-access-key cluster-name
        ```
        The expected output would be:
        ```bash
        14:43:35 info vCluster platform host: https://loftg2fei.loft.host
        14:43:35 info Access Key: xxxxxxxx
        ```
        In this example, `cluster-name` refers to the host cluster containing the [vCluster Platform Agent](/docs/platform/administer/clusters/advanced/agent-config) to be upgraded.

        <!-- vale off -->
        Here, `https://loftg2fei.loft.host` represents the `url`, and `xxxxxxxx` is the `token`.
        <!-- vale on -->
    </Step>
    <Step>
        Next, use the following Helm command to upgrade the platform agent by providing the retrieved `url` and `token`:
        ```yaml
        helm upgrade loft vcluster-platform \
            --repo https://charts.loft.sh \
            --install \
            --create-namespace \
            --namespace vcluster-platform \
            --set agentOnly=true \
            --set url=https://loftg2fei.loft.host \
            --set token=xxxxxxxx
        ```
        You can choose the Helm flags according to your requirements.
        For example, the `--create-namespace` and `--namespace vcluster-platform` flags ensure that a namespace named `vcluster-platform` is created if it does not already exist in the host cluster.
        All Platform agent resources will be deployed and run within that namespace. If you use a different namespace to deploy the resources of the platform agent, set `--namespace` explicitly.
    </Step>
</Flow>