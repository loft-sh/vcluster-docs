---
title: Platform Database
sidebar_label: Database
sidebar_position: 1
description: Information that an admin may need to know about the platform database.
---

import VersionBadge from '@site/src/components/VersionBadge';
import InterpolatedCodeBlock from "@site/src/components/InterpolatedCodeBlock";

<VersionBadge platformVersion="v4.4.0"/>

The platform database is a local postgres database server that is used and managed by vCluster Platform.

## Configure

By default, platform database will leverage the default StorageClass. If you would like to specify a different StorageClass, you can navigate to `Admin > Config` and edit the  `platformDB.storageClass` field.
The value can instead be configured using the vCluster Platform values yaml during install or upgrade of the vCluster Platform by adding the following yaml:

```yaml
platformDB:
  storageClass: <storage-class>
```

## Troubleshoot

The PersistentVolumeClaim that backs the platform database should never be deleted. It is named `platform-db`. In the case that it is deleted, the following steps can be followed to return the platform database to a working state.

1. Set $PLATFORM_NS and $PLATFORM_NAME, based on the name and namespace of the vCluster Platform Deployment.

<InterpolatedCodeBlock
  code={`export PLATFORM_NS=[[VAR:VCLUSTER_NAME:vcluster]] --namespace [[VAR:NAMESPACE:vcluster-demo]]
export PLATFORM_NAME=[[VAR:VCLUSTER_NAME:vcluster-platform]]
export CLUSTER_NAME=[[VAR:CLUSTER_NAME:my-platform-cluster]]
`}
  language="bash"
/>

2. Get current vCluster Platform replicas.

```bash
export DESIRED_REPLICAS=$(kubectl get deployment -n $PLATFORM_NS $PLATFORM_NAME -o json | jq -r '.spec.replicas')
```

3. Scale down vCluster Platform Deployment to 0.

```bash
kubectl scale deployment -n $PLATFORM_NS $PLATFORM_NAME --replicas 0
```

4. Edit the cluster that vCluster Platform is installed in and change the label `loft.sh/platform-db-applied-hash` to a different value, e.g. add a random letter to the string. Deleting the label will also work.

```bash
kubectl edit cluster.storage.loft.sh $CLUSTER_NAME
```

5. Scale up the loft Deployment to its original replica count.

```bash
kubectl scale deployment -n $PLATFORM_NS $PLATFORM_NAME --replicas $DESIRED_REPLICAS
```

6. Confirm that vCluster Platform database becomes available.

```bash
kubectl rollout status deployment/$PLATFORM_NAME -n $PLATFORM_NS
```
