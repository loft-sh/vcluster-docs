---
title: Using the Rancher integration
sidebar_label: Rancher Integration
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem'
import Flow, { Step } from '@site/src/components/Flow'
import NavStep from '@site/src/components/NavStep'
import Button from '@site/src/components/Button'
import Label from '@site/src/components/Label'

import PartialRancher from "../../api/_partials/resources/projects/spec/rancher.mdx";

The vCluster Rancher Operator automatically imports vCluster installations as Rancher clusters. Rancher users can deploy virtual clusters without having cluster create permissions, as the operator handles the necessary setup. Additionally, project owners of the project vCluster is installed in and the cluster owners of the host cluster are automatically assigned as cluster owners in the new Rancher cluster.

After configuring Rancher within the vCluster Platform, you can import virtual clusters into Rancher and manage them as standard clusters.

## Deploy the vCluster Rancher Operator

To install the vCluster Rancher Operator using the Rancher UI:

<Flow id="vcluster-rancher-operator-install">

  <Step>
  In the Rancher UI, navigate to the clusters overview page and select the **local** cluster.
  </Step>

  <Step>
  In the sidebar, go to **Apps** → **Repositories**.
  Click **Create**, set a name (for example `loft-charts`), and enter the **Index URL**:
  `https://charts.loft.sh`
  </Step>

  <Step>
  **Optional**: Click the user icon in the top-right corner, select **Preferences** and enable **Include Prerelease Versions**.
  </Step>

  <Step>
  Navigate to **Apps** → **Charts**.
  Search for **vCluster Rancher Operator**, select it, and follow the installation prompts.
  </Step>

  <Step>
  After installation, navigate to **Workloads** → **Deployments**.
  Ensure that the deployment named `vcluster-rancher-operator` has the state **Active**.
  </Step>

</Flow>

After it is installed, the vCluster Rancher Operator automatically integrates vCluster deployments with Rancher.

### Retrieve the Rancher cluster ID and project ID

<Flow id="rancher-id-lookup">

  <Step>
  In the Rancher UI, navigate to **Cluster Management**.
  </Step>

  <Step>
  Select the desired cluster. Click on the name of the cluster you want to identify.
  </Step>

  <Step>
  Click the **ellipsis (⋮)** to the cluster name and select **View YAML**.
  </Step>

  <Step>
  In the displayed YAML, find the `metadata.name` field. This value is your **Cluster ID**.
  </Step>

  <Step>
  Click **Explore** on the cluster containing the project you're interested in.
  </Step>

  <Step>
  In the cluster navigation menu, click **Projects/Namespaces**.
  </Step>

  <Step>
  Locate the project, click the **ellipsis (⋮)** next to it, and select **View YAML**.
  </Step>

  <Step>
  In the displayed YAML, find the `metadata.name` field. This value is your **Project ID**.
  </Step>
</Flow>

### Project resource

If you are creating a project resource into vCluster Platform directly, you can configure the Rancher integration directly on the <code>projects.managementv1.loft.sh</code> resource.

<PartialRancher />

## Manage virtual clusters in the Rancher UI

### Create a virtual cluster in the Rancher UI

<Flow id="rancher-plugin-create-vcluster">
  <Step>
    In the Rancher home page, click **Create Virtual Cluster**.
  </Step>
  <Step>
    Enter a name for the virtual cluster and select the Rancher project in which you wish to create the virtual cluster. Only those projects which have the Rancher Integration enabled are displayed in the list.
  </Step>
  <Step>
    Click **Create** which takes you to the <Label>Create VirtualClusterInstance</Label> page in the vCluster Platform to get ready to create a virtual cluster.
  </Step>
  <Step>
    Click the <Label>Rancher</Label> configuration tab.
  </Step>
  <Step>
    Slide the <Label>Add to Rancher</Label> toggle to enable.
  </Step>
  <Step>
    Click **Create** after you have configured the rest of the virtual cluster based on your preferences.
  </Step>
  <Step>
   In the Rancher UI, navigate to **☰ > Cluster Management**, locate your virtual cluster in the list, and confirm that its status is labeled as **Active**.
  </Step>
</Flow>

### Delete a virtual cluster in the Rancher UI

<Flow id="rancher-plugin-delete-vcluster">
  <Step>
    In the Rancher home page, click the **Delete** icon for the virtual cluster you want to delete.
  </Step>
  <Step>
    You are redirected to the **VirtualClusterInstance** Page in vCluster Platform for confirmation.
  </Step>
  <Step>
    Click **Delete** to confirm in the platform UI. The virtual cluster is then deleted from Rancher.
  </Step>
</Flow>

## Import virtual clusters into Rancher through vCluster Platform UI

After a vCluster Platform project has the Rancher integration enabled, virtual clusters within that project can be synced into Rancher as an imported cluster in Rancher UI. In the vCluster Platform UI, you can enable virtual cluster import into Rancher during the virtual cluster creation step, or by enabling this feature on existing
virtual clusters.

:::info Make Sure Your Project Has Rancher Enabled
If the project does *not* have Rancher integration enabled, you
might not see the **Add to Rancher** options in the virtual cluster configuration.
:::

<Tabs
    defaultValue="creation"
    values={[
        {label: 'During Virtual Cluster Creation', value: 'creation'},
        {label: 'On Existing Virtual Cluster', value: 'existing'},
    ]}>
    <TabItem value="creation">
        <Flow id="enable-rancher-import-creation">
            <Step>
                In the vCluster Platform UI, select a project that has Rancher integration enabled. 
            </Step>
            <Step>
                Click **Virtual Clusters**.
            </Step>
            <Step>
                In the popup, optionally select the virtual cluster template, then click
                <Button>Configure</Button>.
            </Step>
            <Step>
                Click the <Label>Rancher</Label> configuration tab.
            </Step>
            <Step>
                Enable <Label>Add to Rancher</Label>.
            </Step>
            <Step>
                Finish configuring anything else you would like on your virtual cluster, then click
                <Button>Create</Button>. The virtual cluster is created in vCluster Platform and imported into Rancher.
            </Step>
        </Flow>
    </TabItem>
    <TabItem value="existing">
        <Flow id="enable-rancher-import-existing">
            <Step>
                 In the vCluster Platform UI, select a project that has Rancher integration enabled. 
            </Step>
            <Step>
                Find your desired virtual cluster in the virtual cluster list. Slide the
                <Label>Add to Rancher</Label> slider to import the virtual cluster into Rancher.
            </Step>
        </Flow>
    </TabItem>
</Tabs>

## Hiding nodes in Rancher

Since virtual clusters are not using physical nodes, you can hide the nodes from Rancher in order for the
virtual nodes to not be counted in your Rancher node count. In order to hide the nodes of your virtual cluster, you need to enable our Rancher nodeless plugin on the virtual cluster. 

Add the plugin to your `vcluster.yaml` configuration.

```yaml
plugins:
  rancher:
    image: ghcr.io/loft-sh/rancher-nodeless-plugin:0.0.5
```

:::tip Use Templates for plugins
You can enforce that all virtual clusters enable the plugin by enforcing template usage in the project. 
:::

## Disabe Rancher integration

You can disable the Rancher integration at either the virtual cluster or project level. This is done by toggling the same options used to enable the integration in the UI.

### Disable at the virtual cluster level

Disabling integration at the virtual cluster level removes the cluster from the Rancher UI, but the virtual cluster itself continues running in the background. This is useful if you want to stop managing a specific vCluster through Rancher without deleting it.

### Disable at the project level

:::note
Use caution when disabling integration at the project level, as this impacts all associated virtual clusters.
:::

Disabling integration at the project level removes all virtual clusters in that project from the Rancher UI. The virtual clusters remain active, but they are no longer visible or manageable through Rancher.


<details>
  <summary><strong>Uninstall the vCluster Rancher Operator</strong></summary>

  ## Uninstall the vCluster Rancher Operator
  
  To remove the vCluster Rancher Operator from your environment uninstall Helm. 
  
  ### Helm uninstall
  
  ```bash
  helm delete <release-name>
  ```
  - Replace `<release-name>` with the name of your Helm release.

</details> 
