---
title: Cofigure security context
sidebar_label: Security Context
sidebar_position: 2
---

Security context is one of the common agent configurations. Agent pods support multiple levels of security context configuration.

:::info Security Context Precedence
When multiple security contexts are configured, the agent uses this precedence order (highest to lowest):
1. Cluster-specific `agentValues` (via `loft.sh/agent-values` annotation)
2. Platform-wide `agentValues` (in platform values.yaml)
3. Platform default `securityContext` and `podSecurityContext`

See [Platform configuration](../platform-configs/overview.mdx) for platform-wide settings.
:::

Inspect the security context applied to agent pods:

<InterpolatedCodeBlock
  code={`kubectl get pod -n [[VAR:MANAGEMENT_NAMESPACE:vcluster-platform]] -l app=loft -o yaml | grep -A 10 "securityContext:"`}
  language="bash"
  title="View security contexts"
/>

Example output:
```yaml
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  privileged: false
  runAsNonRoot: true
```

:::info Container vs Pod Security Context
- **Container Security Context** (`securityContext`): Applied to individual containers within a pod. Controls settings like user ID, privilege escalation, and capabilities.
- **Pod Security Context** (`podSecurityContext`): Applied at the pod level. Controls settings like filesystem group, supplemental groups, and sysctls that affect all containers in the pod.

Both Agent Pod and Agent Proxy Pod (deployed during upgrades) follow the same precedence order.
:::

#### Example: Platform-wide Security Context

Configure security contexts in your `vcluster-platform` values file during platform installation:

```yaml title="vcluster-platform values.yaml"
# Platform-wide default security contexts
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
    - ALL

podSecurityContext:
  fsGroup: 2000
  runAsGroup: 3000
  
# Default agent values that apply to all connected clusters
agentValues:
  securityContext:
    allowPrivilegeEscalation: false
    runAsNonRoot: true
    runAsUser: 1001
    capabilities:
      drop:
      - ALL
  podSecurityContext:
    fsGroup: 2001
    runAsGroup: 3001
```

#### Example: Cluster-specific Security Context

Override security contexts for specific clusters using the [`loft.sh/agent-values` annotation](overview#loftsh-annotations):

```yaml title="cluster-specific-agent-values.yaml"
# Applied via loft.sh/agent-values annotation on the Cluster resource
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1002
  capabilities:
    drop:
    - ALL
    add:
    - NET_BIND_SERVICE

podSecurityContext:
  fsGroup: 2002
  runAsGroup: 3002
  supplementalGroups:
  - 4000
  - 5000
```

To apply cluster-specific security context through the UI, follow the steps in [Setting Agent Values via UI](overview#override-values) and add your security context configuration in the Extra Agent Values textarea.
