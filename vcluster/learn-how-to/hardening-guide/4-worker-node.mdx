---
title: Self assessment guide - Worker Node Configuration
sidebar_label: Worker Node Configuration
description: Self assessment guide to validate Worker Node configuration
---

This section provides security recommendations for components running on Kubernetes worker nodes:
- Kubelet configuration and security
- File system permissions

_Assessment focus for vCluster_: Since vCluster uses the host cluster's nodes, this section's requirements are primarily inherited from the host cluster's configuration. Verification should focus on ensuring the host cluster meets these requirements.

<!-- vale Google.Headings = NO -->
## 4.1 Worker Node Configuration Files
<!-- vale Google.Headings = YES -->
### 4.1.1 Ensure that the kubelet service file permissions are set to 600 or more restrictive (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the below command (based on the file location on your system) on the each worker node. For example,
```bash
chmod 600 /etc/systemd/system/kubelet.service.d/kubeadm.conf
```

### 4.1.2 Ensure that the kubelet service file ownership is set to root:root (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the below command (based on the file location on your system) on the each worker node. For example,
```bash
chown root:root /etc/systemd/system/kubelet.service.d/kubeadm.conf
```

### 4.1.3 If proxy kubeconfig file exists ensure permissions are set to 600 or more restrictive (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the below command (based on the file location on your system) on the each worker node. For example,
```bash
chmod 600 <proxy kubeconfig file>
```

### 4.1.4 If proxy kubeconfig file exists ensure ownership is set to root:root (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the below command (based on the file location on your system) on the each worker node. For example,
```bash
chown root:root <proxy kubeconfig file>
```

### 4.1.5 Ensure that the --kubeconfig kubelet.conf file permissions are set to 600 or more restrictive (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the below command (based on the file location on your system) on the each worker node. For example,
```bash
chmod 600 /etc/kubernetes/kubelet.conf
```

### 4.1.6 Ensure that the --kubeconfig kubelet.conf file ownership is set to root:root (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the below command (based on the file location on your system) on the each worker node. For example,
```bash
chown root:root /etc/kubernetes/kubelet.conf
```

### 4.1.7 Ensure that the certificate authorities file permissions are set to 600 or more restrictive (Automated)

**Result:** NOT APPLICABLE


**Remediation:** Run the following command to modify the file permissions of the `--client-ca-file`
```bash
chmod 600 <filename>
```

### 4.1.8 Ensure that the client certificate authorities file ownership is set to root:root (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the following command to modify the ownership of the `--client-ca-file`.
```bash
chown root:root <filename>
```

### 4.1.9 Ensure that the kubelet --config configuration file has permissions set to 600 or more restrictive (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the following command (using the config file location identied in the Audit step)
```bash
chmod 600 /var/lib/kubelet/config.yaml
```

### 4.1.10 Ensure that the kubelet --config configuration file ownership is set to root:root (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Run the following command (using the config file location identied in the Audit step)
```bash
chown root:root /etc/kubernetes/kubelet.conf
```

## 4.2 Kubelet
### 4.2.1 Ensure that the --anonymous-auth argument is set to false (Automated)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `authentication: anonymous: enabled` to `false`. If using executable arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the below parameter in `KUBELET_SYSTEM_PODS_ARGS` variable.
```bash
--anonymous-auth=false
```
Based on your system, restart the kubelet service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```
<!-- vale Google.Headings = NO -->
### 4.2.2 Ensure that the --authorization-mode argument is not set to AlwaysAllow (Automated)
<!-- vale Google.Headings = YES -->

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `authorization: mode` to `Webhook`.
If using executable arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the below parameter in `KUBELET_AUTHZ_ARGS` variable.
```bash
--authorization-mode=Webhook
```
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

### 4.2.3 Ensure that the --client-ca-file argument is set as appropriate (Automated)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `authentication: x509: clientCAFile` to the location of the client CA file.
If using command line arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the below parameter in `KUBELET_AUTHZ_ARGS` variable.
```bash
--client-ca-file=<path/to/client-ca-file>
```
Based on your system, restart the kubelet service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

<!-- vale Google.LyHyphens = NO -->
### 4.2.4 Ensure that the --read-only-port argument is set to 0 (Automated)
<!-- vale Google.LyHyphens = YES -->

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `readOnlyPort` to `0`.
If using command line arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the below parameter in `KUBELET_SYSTEM_PODS_ARGS` variable.
```bash
--read-only-port=0
```
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```
### 4.2.5 Ensure that the --streaming-connection-idle-timeout argument is not set to 0 (Manual)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `streamingConnectionIdleTimeout` to a value other than 0.
If using command line arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the below parameter in `KUBELET_SYSTEM_PODS_ARGS` variable.
```bash
--streaming-connection-idle-timeout=5m
```
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

### 4.2.6 Ensure that the --make-iptables-util-chains argument is set to true (Automated)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `makeIPTablesUtilChains: true`.
If using command line arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and remove the `--make-iptables-util-chains` argument from the `KUBELET_SYSTEM_PODS_ARGS` variable.

Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

### 4.2.7 Ensure that the --hostname-override argument is not set (Manual)

**Result:** NOT APPLICABLE

**Remediation:** Edit the kubelet service file `/etc/systemd/system/kubelet.service.d/10-kubeadm.conf` on each worker node and remove the `--hostname-override` argument from the `KUBELET_SYSTEM_PODS_ARGS` variable.
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

### 4.2.8 Ensure that the eventRecordQPS argument is set to a level which ensures appropriate event capture (Manual)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `eventRecordQPS:` to an appropriate level.
If using command line arguments, edit the kubelet service file `/etc/systemd/system/kubelet.service.d/10-kubeadm.conf` on each worker node and set the below parameter in `KUBELET_ARGS` variable.
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

### 4.2.9 Ensure that the --tls-cert-file and --tls-private-key-file arguments are set as appropriate (Automated)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set tlsCertFile to the location of the certificate file to use to identify this Kubelet, and tlsPrivateKeyFile to the location of the corresponding private key file.
If using command line arguments, edit the kubelet service file  /etc/kubernetes/kubelet.conf` on each worker node and set the below parameters in `KUBELET_CERTIFICATE_ARGS` variable.
```bash
--tls-cert-file=<path/to/tls-certificate-file> --tls-private-key-file=<path/to/tls-key-file>
```
Based on your system, restart the kubelet service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

### 4.2.10 Ensure that the --rotate-certificates argument is not set to false (Automated)

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to add the line `rotateCertificates: true` or remove it altogether to use the default value. 
If using command line arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and remove `--rotate-certificates=false` argument from the `KUBELET_CERTIFICATE_ARGS` variable or set --rotate-certificates=true.
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

<!-- vale Google.Headings = NO -->
### 4.2.11 Verify that the RotateKubeletServerCertificate argument is set to true (Automated)
<!-- vale Google.Headings = YES -->

**Result:** NOT APPLICABLE

**Remediation:** Edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the below parameter in `KUBELET_CERTIFICATE_ARGS` variable.
```bash
--feature-gates=RotateKubeletServerCertificate=true
```
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

<!-- vale Google.Headings = NO -->
### 4.2.12 Ensure that the Kubelet only makes use of Strong Cryptographic Ciphers (Automated)
<!-- vale Google.Headings = YES -->

**Result:** NOT APPLICABLE

**Remediation:** If using a Kubelet config file, edit the file to set `TLSCipherSuites:` to 
```
TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM
_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM
_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM
_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
```
or to a subset of these values.<br/>
If using executable arguments, edit the kubelet service file `/etc/kubernetes/kubelet.conf` on each worker node and set the `--tls-cipher-suites` parameter as follows, or to a subset of these values.
```bash
--tls-cipher-
suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM
_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM
_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM
_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256
```
Based on your system, restart the `kubelet` service. For example:
```bash
systemctl daemon-reload
systemctl restart kubelet.service
```

<!-- vale Google.Headings = NO -->
### 4.2.13 Ensure that a limit is set on pod PIDs (Manual)
<!-- vale Google.Headings = YES -->

**Result:** NOT APPLICABLE

**Remediation:** Decide on an appropriate level for this parameter and set it, either via the `--pod-max-pids` command line parameter or the `PodPidsLimit` configuration file setting.

<!-- vale Google.Headings = NO -->
## 4.3 kube-proxy
<!-- vale Google.Headings = YES -->
### 4.3.1 Ensure that the kube-proxy metrics service is bound to localhost (Automated)

**Result:** NOT APPLICABLE

**Remediation:** Modify or remove any values which bind the metrics service to a non-localhost address
