---
title: Deletion
sidebar_label: deletion
sidebar_position: 6
description: Configure virtual cluster deletion
sidebar_class_name: pro host-nodes
---

import Button from "@site/src/components/Button";
import Expander from "@site/src/components/Expander";
import Label from "@site/src/components/Label";
import Flow, { Step } from "@site/src/components/Flow";
import NavStep from "@site/src/components/NavStep";
import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import ProAdmonition from '../../_partials/admonitions/pro-admonition.mdx'
import Deletion from '../../_partials/config/deletion.mdx'
import FeatureTable from '@site/src/components/FeatureTable';

<FeatureTable names="vcp-distro-sleep-mode" />

<ProAdmonition />

Accidental deletion of virtual clusters is something that can not be reverted. In order to prevent deletion of virtual clusters you can either set `deletion.prevent` or the `loft.sh/non-deletable` annotation to true.

:::note
If you want to delete this virtual cluster in the future, you need to either toggle `deletion.prevent` to false, remove the annotation in the YAML manifest or through the toggle in the UI.
Once you have done this, you can delete the virtual cluster as usual.
:::

There are scenarios where it is desirable that virtual clusters are automatically deleted after a certain inactivity duration. This could be after firing up single-shot batch jobs or more generally not having to remember cleaning things up afterwards.
You can enable automatic deletion by configuring `deletion.auto` accordingly.

:::important
In order for auto deletion to work it requires an agent to be installed on the host cluster of the virtual cluster.
:::

## Configure

<Tabs
  defaultValue="yaml"
  values={[
    { label: "vcluster.yaml", value: "yaml" },
    { label: "Platform UI", value: "ui" },
    { label: "Platform CRDs", value: "crds" },
  ]}
>
<TabItem value="yaml">
### Prevent deletion

To prevent a virtual cluster from being deleted, add the following configuration to your `vcluster.yaml`:

```yaml title="Prevent Deletion"
deletion:
  prevent: true
```

### Deletion after inactivity

To enable automatic deletion after a certain inactivity duration, add the following configuration to your `vcluster.yaml`:

```yaml title="Automatic Deletion"
deletion:
  auto:
    afterInactivity: 1m # Uses Go duration format
```
</TabItem>

<TabItem value="ui">

<Flow id="vcluster-prevent-deletion-ui">
  <Step>
    From the project drop-down menu (top left corner), select the project you'd like to create the
    virtual cluster in.
  </Step>
  <Step>
    Click on <NavStep>Virtual Clusters</NavStep>.
  </Step>
  <Step>
    Click on <Label>Edit</Label> on the virtual cluster that you want to edit.
  </Step>
  <Step>
    Select the <Expander>Auto-Sleep and Auto-Deletion</Expander> expander and toggle the <Label>Prevent Deletion</Label> slider accordingly or configure an inactivity duration (<Label>Sleep After Inactivity</Label>) for auto deletion.
  </Step>

<Step>
  Click on the <Button>Save</Button> button to save the changes.
</Step>

</Flow>
</TabItem>

<TabItem value="crds">
  You can prevent virtual cluster deletion, by setting the annotation `loft.sh/non-deletable: "true"` in the YAML manifest of the virtual cluster instance.

```yaml {6}
apiVersion: management.loft.sh/v1
kind: VirtualClusterInstance
metadata:
  name: my-vcluster
  annotations:
    loft.sh/non-deletable: "true"
spec:
  templateRef:
    name: isolated-vcluster
  clusterRef:
    cluster: loft-clusterth
```

</TabItem>

</Tabs>

## Config reference

<Deletion />
