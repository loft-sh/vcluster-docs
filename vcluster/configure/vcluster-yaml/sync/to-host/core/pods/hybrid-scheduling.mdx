---
title: Hybrid Scheduling
sidebar_label: hybridScheduling
description: Configuration for ...
---

Hybrid scheduling enables you to use custom schedulers from both host and virtual cluster at
the same time for virtual cluster workloads.

You can enable hybrid scheduling like this:

```yaml
sync:
  toHost:
    pods:
      hybridScheduling:
        enabled: true
        hostSchedulers:
        - my-custom-scheduler
  fromHost:
    nodes:
      enabled: true
```

Notice that you must also enable syncing of real nodes from the host to the virtual cluster.
If you don't enable syncing of real nodes, you wil get an error.

By default, all the nodes are synced from the host. You can also choose to sync only nodes
with specific labels by specifying labels selector for nodes like showed in the example
below.

```yaml
sync:
  toHost:
    pods:
      hybridScheduling:
        enabled: true
        hostSchedulers:
        - my-custom-scheduler
  fromHost:
    nodes:
      enabled: true
      labels:
        environment: production
        team: backend
```

## Use host schedulers

`sync.toHost.pods.hybridScheduling.hostSchedulers` is a list of schedulers that exist on the host
cluster, which can be used by the pods in the virtual cluster.

The default Kubernetes scheduler from the host cluster is always implicitly included in the
`sync.toHost.pods.hybridScheduling.hostSchedulers` list. This means that all the pods that are
using the default Kubernetes scheduler (either implicitly when pod's `.spec.schedulerName`
field is not set, or explicitly, when `.spec.schedulerName` is set to `default-scheduler`) are
scheduled by the Kubernetes scheduler that is running on the host cluster.

### Use custom host schedulers

The following hybrid scheduling configuration enables pods from the virtual cluster to use
custom schedulers `my-custom-scheduler` and `my-gpu-scheduler` from the host cluster (the rest
of the vCluster config is omitted for brevity):

```yaml
sync:
  toHost:
    pods:
      hybridScheduling:
        enabled: true
        hostSchedulers:
        - my-custom-scheduler
        - my-gpu-scheduler
```

Then, in your virtual cluster, you can deploy pods that use custom schedulers
`my-custom-scheduler` and `my-gpu-scheduler` from the host cluster, for example:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-example
spec:
  schedulerName: my-custom-scheduler
  containers:
  - name: pause
    image: registry.k8s.io/pause:3.10
---
apiVersion: v1
kind: Pod
metadata:
  name: my-gpu-example
spec:
  schedulerName: my-gpu-scheduler
  containers:
  - name: pause
    image: registry.k8s.io/pause:3.10
```

## Use custom virtual schedulers

Virtual cluster pods can use a custom scheduler that is running in the virtual cluster. For
this to work correctly, don't add custom virtual schedulers to the
`sync.toHost.pods.hybridScheduling.hostSchedulers` list in your vCluster config.

The following examples show a pod that is scheduled by custom scheduler
`my-virtual-ai-scheduler` that is running in the virtual cluster, and the hybrid scheduling
configuration needed for that.

Hybrid scheduling configuration:

```yaml
sync:
  toHost:
    pods:
      hybridScheduling:
        enabled: true
```

Pod:

```
apiVersion: v1
kind: Pod
metadata:
  name: my-ai-example
spec:
  schedulerName: my-virtual-ai-scheduler
  containers:
  - name: pause
    image: registry.k8s.io/pause:3.10
```

## Other related configuration and cluster permissions

With the Hybrid Scheduling enabled, and when the `PersistentVolumeClaims` are configured to be
synced from the virtual to the host cluster, then, in order for scheduling to work correctly, the
following resources are automatically synced from the host to the virtual cluster (unless you
explicitly disable this in the vCluster config):
- `CSINodes`,
- `CSIStorageCapacities`,
- `CSIDrivers`.

Similarly to the above, when the `PersistentVolumeClaims` are configured to be synced to the host
cluster, syncing of `StorageClasses` from the host to the virtual cluster is also automatically
enabled, but only when syncing of `StorageClasses` from the virtual to the host cluster is disabled.

:::warning
Manually disabling `CSINodes`, `CSIStorageCapacities`, `CSIDrivers` and `StorageClasses` sync
in the above cases can cause pod scheduling to fail in your virtual cluster.
:::


vCluster automatically adds the required `ClusterRole` rules, so that automatically enabled
`CSINodes`, `CSIStorageCapacities`, `CSIDrivers` and `StorageClasses` syncing works correctly.

