---
title: Secrets
sidebar_label: secrets
sidebar_position: 11
description: Configuration for ...
---

import EnableSwitch from '../../../../_partials/config/sync/fromHost/secrets.mdx'
import ProAdmonition from '../../../../_partials/admonitions/pro-admonition.mdx'
import FromHostSecretExample from '../../../../_fragments/sync-from-host-secret-example.mdx'

By default, this is turned off.

:::info No need to configure RBAC
vCluster automatically adds the required cluster RBAC permissions for retrieving the secrets and syncing the resources from the host to the virtual cluster.
:::

Enabling this allows you to sync Secrets from the specified namespaces in the host to the specified namespaces in the vCluster.

It is also possible to modify the name of the synced resource in the virtual cluster.

There is no option to sync from all namespaces in the host.

Sync is one-directional, from host to virtual. If you modify an object in the host, vCluster syncs the change to virtual object. When you delete virtual object, vCluster re-creates it if the host object still exist.

When you delete host object, vCluster deletes virtual object.

You can use synced Secrets in your workloads as an environment variables source or a volume.

It is not possible to sync Secrets that were already synced from virtual to host, they are skipped by vCluster.

Namespaces in the virtual cluster are created automatically during the sync (if they do not exist already).

## Prerequisites
All the specified namespaces have to exist in the host at the vCluster startup.


## Sync all secrets from host namespace
To sync all Secrets from a given namespace in the host to the given namespace in the virtual cluster, “namespace/*” wildcard can be used, e.g.:

```yaml
sync:
  fromHost:
    secrets:
      enabled: true
      selector:
        mappings:
          # syncs all Secrets from "foo" namespace
          # to the "bar" namespace in vCluster. Secrets names are unchanged.
          "foo/*": "bar/*"
```


## Sync only specific secrets from host namespace
To sync only specific Secrets from namespaces, you need to provide `namespace/name` as the key and value:

```yaml
sync:
  fromHost:
    secrets:
      enabled: true
      selector:
        mappings:
          # syncs Secret named "cm-name" from "foo" host namespace
          # to the "bar" namespace in virtual.
          "foo/cm-name": "bar/cm-name"
```


## Sync all secrets from vCluster's host namespace
There is also a handy syntax to sync all Secrets from vCluster’s own host namespace to the virtual namespace. As vCluster’s namespace is not always known upfront (e.g. when vCluster is created by the platform), `""` (empty string) is treated as “vCluster’s own host namespace”.

```yaml
sync:
  fromHost:
    secrets:
      enabled: true
      selector:
        mappings:
          # syncs all Secrets from vCluster's host namespace
          # to "my-virtual" namespace in vCluster.
          "": "my-virtual"
```


## Sync specific secret from vCluster's host namespace
you can also specify only a few Secrets from vCluster’s own host namespace this way:

```yaml
sync:
  fromHost:
    secrets:
      enabled: true
      selector:
        mappings:
          # syncs Secret named "my-cm" from vCluster's host namespace
          # to "my-virtual-namespace" in vCluster.
          "/my-cm": "my-virtual/my-cm"
```

## Modify synced secret namespace and name in the virtual cluster
It’s also possible to modify Secret name during the sync:

```yaml
sync:
  fromHost:
    secrets:
      enabled: true
      selector:
        mappings:
          # syncs "config" Secret from "cert-manager" namespace in the host
          # as "my-config" in "my-virtual" namespace in vCluster.
          "cert-manager/config": "my-virtual/my-config"
```

## Pro patches

<ProAdmonition/>

You can specify `reverseExpression` in the `sync.fromHost.secrets.patches` .

They are applied on the host object and appear in the virtual object.

`expressions` have no effect.

So, for the following `vcluster.yaml` :

```yaml
sync:
  fromHost:
    secrets:
      enabled: true
      selector:
        mappings:
          "default/my-cm": "barfoo2/cm-my"
      patches:
        - path: metadata.annotations[*]
          #expression: '"my-prefix-"+value'
          # optional reverseExpression to reverse the change from the host cluster
          reverseExpression: "value.startsWith('www.') ? value.slice(4) : value"
```

1. Your Secret in the host namespace `default` named `my-cm` is synced to the namespace `barfoo2` in virtual and named `cm-my`.
2. If `default/my-cm` host object has annotation which value starts with `www.` , e.g.: `my-address: www.loft.sh` then synced object in the virtual cluster `barfoo2/cm-my` has annotation `my-address: loft.sh` .


<FromHostSecretExample />

## Config reference

<EnableSwitch/>
