---
title: Device classes
sidebar_label: deviceClasses
sidebar_position: 13
description: Configuration for DeviceClasses in vCluster
sidebar_class_name: host-nodes
---

import CodeBlock from '@theme/CodeBlock';
import EnableSwitch from '../../../../_partials/config/sync/fromHost/deviceClasses.mdx'
import EnableSyncing from '../../../../_fragments/sync/class-syncing-enable.mdx'
import UseSelectors from '../../../../_fragments/sync/class-syncing-selectors.mdx'
import TenancySupport from '../../../../_fragments/tenancy-support.mdx';

import FeatureTable from '@site/src/components/FeatureTable';

<FeatureTable names="dra-sync" />

<TenancySupport hostNodes="true" />

<!-- vale off -->

By default, this is disabled.

DeviceClass syncing allows virtual clusters to use device classes from the host cluster. 
With DeviceClass syncing enabled, virtual clusters can reference DeviceClass resources from the 
host cluster in [resourceclaims](../to-host/DRA/resourceclaims) and [resourceclaimtemplates](../to-host/DRA/resourceclaimtemplates).

You can enable this feature to sync DeviceClass resources from the host cluster to the virtual cluster.
Add labels to DeviceClass resources in your host cluster and configure vCluster to sync only those that match specific label selectors.
When you create a ResourceClaims or ResourceClaimTemplates resource in the virtual cluster that references a synced DeviceClass, the host cluster's resourceclaim controller handles the resource claims allocation.

This saves resources since you don't need resourceclaim controllers in every virtual cluster.
It also gives you centralized control over which DeviceClass teams can access. 

This approach is useful in scenarios where selective access to DeviceClass configurations is required. Common use cases include:

- **Development environments**: Sync only the DeviceClass resources required for development clusters to reduce noise and avoid unnecessary exposure.
- **Multi-tenancy**: Enable teams to use their own DeviceClass resources while sharing a single host cluster.
- **Security**: Restrict the DeviceClass resources available in the virtual cluster to enforce access control and prevent unintended configurations.

<EnableSyncing resourceClass="DeviceClass" pluralResourceClass="deviceClasses" />

## How syncing works

When DeviceClass syncing is enabled, vCluster can use a label selector to control which DeviceClass, ResourceClaims and ResourceClaimTemplates resources are synchronized between the host and virtual clusters. 
This affects the resource types with separate unidirectional sync flows:

- **DeviceClass resources (host → virtual)**: vCluster syncs DeviceClass resources from the host cluster to the virtual cluster. You cannot create DeviceClass resources directly in the virtual cluster. If a selector is defined, only DeviceClass resources matching the selector will sync. If no selector is defined, **all** DeviceClass resources are synced.

- **ResourceClaims resources (virtual → host)**: vCluster syncs ResourceClaims resources from the virtual cluster to the host cluster only if all the referenced `deviceClassName` exist in the host cluster and any of the following is true:
    - No selector is defined for DeviceClass syncing, which allows all ResourceClaims resources to sync regardless of the `deviceClassName`.
    - Each of the ResourceClaims's `deviceClassName` references a DeviceClass resource that matches the selector and is synced from the host cluster. 

- **ResourceClaimTemplates resources (virtual → host)**: vCluster syncs ResourceClaimTemplates resources from the virtual cluster to the host cluster only if all the referenced `deviceClassName` exist in the host cluster and any of the following is true:
    - No selector is defined for DeviceClass syncing, which allows all ResourceClaimTemplates resources to sync regardless of the `deviceClassName`.
    - Each of the ResourceClaimTemplates's `deviceClassName` references a DeviceClass resource that matches the selector and is synced from the host cluster. 

The same selector controls both sync flows. The selector determines which DeviceClass resources are imported from the host cluster and which ResourceClaims and ResourceClaimTemplates resources can sync to the host cluster based on the referenced DeviceClass resources.

<UseSelectors showResource="true" resource="ResourceClaims" pluralResource="resourceClaims" resourceClass="DeviceClass" pluralResourceClass="deviceClasses" expressionKey="kubernetes.io/device.class" expressionValue1="nvidia" expressionValue2="amd" />

## Sync behavior considerations

### Resource lifecycle

Synced DeviceClass resources function like any other Kubernetes resource in the virtual cluster. You
can view them with <code>kubectl get deviceclass</code> and reference them in your ResourceClaims 
and ResourceClaimTemplates resources specifications with the <code>DeviceClassName</code> field.

When you modify the DeviceClass resource in the host cluster, vCluster re-evaluates whether it still matches the selector criteria. If the DeviceClass continues to match, vCluster updates the corresponding resource in the virtual cluster to reflect the changes. If the DeviceClass no longer matches the selector criteria, vCluster removes it from the virtual cluster.

The selector system acts as both a resource filter and a validation mechanism. As a resource filter, it
ensures that vCluster creates only DeviceClass resources matching the defined selector criteria.
The selector also functions as a creation validation mechanism - when you create ResourceClaims and ResourceClaimTemplates
resources in the virtual cluster, the resources can only reference DeviceClass resources that exist in the virtual cluster.

### Orphaned resources

When vCluster removes a synced DeviceClass from the virtual cluster due to selector changes or deletion from the host cluster,
any ResourceClaims and ResourceClaimTemplates resources that reference it remain in the virtual and host clusters. 
These orphaned ResourceClaims and ResourceClaimTemplates resources stop receiving updates but vCluster does not
automatically delete them to prevent unintended data loss.

To remove these orphaned resources, you must delete them manually in the virtual and host clusters. 
This manual approach ensures that you maintain full control over resource cleanup and can verify that deletions are intentional.

### Error handling and troubleshooting

When the DeviceClass resource doesn't match the selector criteria during evaluation, vCluster logs a warning in the syncer
pod's output to help with troubleshooting and monitoring. This logging provides visibility into which resources are being
filtered out and why.

When you create ResourceClaims and ResourceClaimTemplates resources that reference a DeviceClass not matching
the selector criteria, several things occur to provide clear feedback:

- The ResourceClaims or ResourceClaimTemplates fails to sync to the host cluster
- vCluster records an event on the ResourceClaims or ResourceClaimTemplates resource in the virtual cluster
- The event indicates that the specified DeviceClass is not available according to the current selector configuration

The error output appears as a Kubernetes event that you can view using `kubectl describe`. The event message clearly states that the ResourceClaims or ResourceClaimTemplates resource was not synced because the referenced DeviceClass does not match the defined selector criteria.

The error output looks like this:

<CodeBlock language="bash" title="Example error handling output">
{`vcluster-virtual-cluster-1:~$ kubectl describe resourceclaim my-resourceclaim
Name:                       my-resourceclaim
Namespace:                  default
DeviceClass:                amd
Events:
    Type     Reason            Age   From                   Message
    ----     ------            ----  ----                    -------
    Warning  SyncWarning       10s   resourceclaim-syncer      did not sync resourceclaim "my-resourceclaim" to host. Failures : Device class amd does not match the selector under 'sync.fromHost.deviceClasses.selector'`}
</CodeBlock>

## Config reference

<EnableSwitch/>
