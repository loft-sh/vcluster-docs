---
title: Ingress classes
sidebar_label: ingressClasses
sidebar_position: 3
description: Configuration for IngressClasses in vCluster
---

import EnableSwitch from '../../../../_partials/config/sync/fromHost/ingressClasses.mdx'

{/*
`ingressClasses.enabled`:
- covered by the generic section here: https://www.vcluster.com/docs/syncer/config#enable-or-disable-synced-resources
- original issue: https://github.com/loft-sh/vcluster/issues/663
*/}

By default, IngressClass synchronization is disabled.

You can enable this feature to sync `IngressClass` resources from the host cluster to the virtual cluster.

This is useful in scenarios where selective access to ingress configurations is required. Common use cases include:

- **Development environments**: Sync only the IngressClasses required for development clusters to reduce noise and avoid unnecessary exposure.
- **Multi-tenancy**: Enable teams to use their own IngressClasses while sharing a single host cluster.
- **Security**: Restrict the IngressClasses available in the virtual cluster to enforce access control and prevent unintended configurations.

## Enable syncing IngressClasses from the host to virtual cluster

```YAML
sync:
  fromHost:
    ingressClasses:
      enabled: true
```

<!-- vale off -->

:::note
When `sync.fromHost.ingressClasses.enabled` is enabled, any `IngressClass` created in the virtual cluster will be immediately deleted.
:::

### Example

The following configuration syncs all `IngressClasses` that match the specified labels and expressions from the host cluster to the virtual cluster:

```YAML
sync:
  toHost:
    ingresses:
      enabled: true
  fromHost:
    ingressClasses:
      enabled: true
      selector:
        matchLabels:
          # Match all IngressClasses with the label `environment` with value `development`
          environment: "development"
        matchExpressions:
          # Match IngressClasses with the label `kubernetes.io/ingress.class` that are either `nginx` or `traefik`
          - key: "kubernetes.io/ingress.class"
            operator: In
            values:
              - nginx
              - traefik
```

The `selector` field follows the same syntax as Kubernetes label selectors. Use it to filter which `IngressClass` resources are synced from the host cluster based on their labels.

:::note
All specified label conditions must match for an `IngressClass` to be included in the sync.
:::


## Use selectors to filter IngressClasses

Use `matchLabels` and `matchExpressions` to filter which `IngressClass` resources are synced based on their labels.

- `matchLabels`: Defines exact label key-value pairs.

  For example, to sync only `IngressClasses` labeled `environment: development`:

  ```yaml
  matchLabels:
    environment: development
  ```

- `matchExpressions`: Allows more flexible, set-based filtering.

  For example, to sync `IngressClasses` where the label `kubernetes.io/ingress.class` is either `nginx` or `traefik`:

  ```yaml
  matchExpressions:
    - key: kubernetes.io/ingress.class
      operator: In
      values:
        - nginx
        - traefik
  ```
  Supported operators are `In`, `NotIn`, `Exists`, and `DoesNotExist`.

For more details on how to use label selectors effectively, refer to the [Kubernetes documentation on label selectors](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#resources-that-support-set-based-requirements).

## Sync behavior and considerations

When `IngressClass` synchronization is enabled, the vCluster syncer uses selector criteria to control which `IngressClasses` are synchronized between the host and virtual clusters.

The selector configuration creates a bidirectional filter:

- **From host to virtual cluster**: Only `IngressClasses` matching the selector criteria are synchronized from the host cluster to the virtual cluster.

- **From virtual cluster to host**: `Ingress` resources created in the virtual cluster are synchronized to the host only if they reference `IngressClasses` that match the selector criteria.

### Resource availability and updates

- Synced `IngressClass` resources appear in the virtual cluster and can be referenced by `Ingress` resources.
- When an `IngressClass` in the host cluster is modified, the selector is re-evaluated:
  - If it still matches, the resource is updated in the virtual cluster.
  - If it no longer matches, it is removed from the virtual cluster.
- If an `IngressClass` fails to meet the selector criteria, a warning is logged in the vCluster syncer podâ€™s output.

### Orphaned Ingress resources

- If a synced `IngressClass` is removed from the virtual cluster (due to selector mismatch or deletion), any `Ingress` resources referencing it remain in the virtual cluster.
- These `Ingress` resources stop receiving updates but are not automatically deleted.
- To remove them, you must delete them manually in the host cluster.

## Constraint enforcement

The selector acts as both a filter and a validation mechanism:

- **Resource filtering**: Only `IngressClasses` that match the selector criteria are made available in the virtual cluster's API server.

- **Creation validation**: `Ingress` resources in the virtual cluster can only reference `IngressClasses` that exist in the filtered set.

- **Sync restriction**: `Ingress` resources referencing non-matching `IngressClasses` are blocked from synchronizing to the host cluster.

## Error handling

When an `Ingress` resource references an `IngressClass` that doesn't match the selector criteria:

- The `Ingress` synchronization to the host cluster fails.
- An event is recorded on the `Ingress` resource in the virtual cluster.
- The event indicates that the specified `IngressClass` is not available in the host.

The event output looks similar to the following:

```shell
vcluster-virtual-cluster-1:~$ kubectl describe ingress my-ingress
Name:             my-ingress
Namespace:        default
Ingress Class:    nginx
Events:
  Type     Reason            Age   From                Message
  ----     ------            ----  ----                -------
  Warning  SyncWarning       10s   ingress-syncer      did not sync ingress "my-ingress" to host because it does not match the selector under 'sync.fromHost.ingressClasses.selector'
```

## Config reference

<EnableSwitch/>
