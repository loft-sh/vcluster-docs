---
title: CSI storage capacities
sidebar_label: csiStorageCapacities
sidebar_position: 7
sidebar_class_name: host-nodes
---

import EnableSwitch from '../../../../_partials/config/sync/fromHost/csiStorageCapacities.mdx'
import TenancySupport from '../../../../_fragments/tenancy-support.mdx';

<TenancySupport hostNodes="true" />

{/*
`csiStorageCapacities.enabled`:
- covered by the generic section here: https://www.vcluster.com/docs/syncer/config#enable-or-disable-synced-resources
- Added as part of this issue: https://github.com/loft-sh/vcluster/issues/773
- tl;dr: syncing these from the host helps the virtual cluster scheduler make decisions about which node to schedule pods to.
*/}

Sync [CSIStorageCapacity](https://kubernetes.io/docs/concepts/storage/storage-capacity/) resources from the host cluster to the 
virtual cluster if the `.nodeTopology` matches a synced node. Use this in conjunction with the virtual scheduler inside of vCluster 
for more advanced scheduling needs. Syncing the CSIStorageCapacity resources from the host helps the virtual scheduler make decisions about which node to schedule pods to.

CSIStorageCapacity is a namespaced resource. When synchronizing from the host cluster to the virtual cluster, all CSIStorageCapacity objects are synced into the kube-system 
namespace of the virtual cluster. During this process, the object name is transformed to the format `<objname>-x-<namespace>`, where `<objname>` is the original object name 
in the host cluster and `<namespace>` is the namespace in which the object originally existed in the host cluster.

When synchronizing from the virtual cluster back to the host cluster, a CSIStorageCapacity object is created in the host cluster only if it includes the physical location 
annotations normally added by the syncer. Specifically:
- `vcluster.loft.sh/object-name` specifies the object name in the host cluster.
- `vcluster.loft.sh/object-namespace` specifies the host cluster namespace.
If these annotations are not present, the CSIStorageCapacity object will not be created or updated in the host cluster.
```yaml title="Physical annotations of CSIStorageCapacity"
apiVersion: storage.k8s.io/v1
kind: CSIStorageCapacity
metadata:
  name: fast-ssd-x-storage-a
  namespace: kube-system
  annotations:
    vcluster.loft.sh/object-name: fast-ssd
    vcluster.loft.sh/object-namespace: storage-a
    # optional bookkeeping:
    # vcluster.loft.sh/object-uid: "c1a2b3c4-..."
    # vcluster.loft.sh/object-kind: "storage.k8s.io/v1, Kind=CSIStorageCapacity"
```

## Default value

Default: `enabled: auto`.

## Sync CSIStorageCapacities from the host to virtual cluster

Configure `enabled: true` if you aren't using the virtual schedular but want to sync CSIStorageCapacity resources.

```YAML
sync:
  fromHost:
    csiStorageCapacities:
      enabled: true
```

## Config reference

<EnableSwitch/>
