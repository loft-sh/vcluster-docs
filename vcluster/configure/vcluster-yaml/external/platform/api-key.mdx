---
title: apiKey
sidebar_label: apiKey
sidebar_position: 1
toc_max_heading_level: 2
---

import ProAdmonition from '../../../../_partials/admonitions/pro-admonition.mdx'

import Mark from "@site/src/components/Mark";
import InterpolatedCodeBlock from "@site/src/components/InterpolatedCodeBlock";
import ApiKey from '@site/platform/api/_partials/resources/config/external/platform/apiKey.mdx'
import Flow, { Step } from '@site/src/components/Flow';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


<ProAdmonition/>

<!--vale off-->

This provides a way to connect directly to the vCluster Platform.

## Connect virtual clusters to the vCluster Platform 

To connect a virtual cluster to the vCluster Platform, you can use an API keyâ€”referred to as an [access key](/platform/next/api/authentication) in the platform's UI. There are two authentication methods:

- **Shared access key** (_Recommended_): Create a single Kubernetes Secret containing the access key, and reference it in multiple virtual clusters, even if they are deployed in different namespaces. This approach simplifies management, reduces overhead, and eases credential rotation, making it suitable for most users and production environments. For most scenarios, using a shared access key is the preferred approach due to its simplicity and ease of maintenance.

- **Individual access keys**: Create separate Kubernetes Secrets, each with a unique access key, for every virtual cluster. This method provides granular access control and allows revocation of access to individual clusters.


<br />

<Tabs>
  <TabItem value="shared" label="Shared access key" default>
    
  ### Prerequisites

  Before you begin, ensure you have: 

  - A vCluster Platform instance set up and accessible.
  - Permissions to create an access key in the platform.
  - Access to create Kubernetes Secrets on the host Kubernetes cluster (where the virtual cluster runs).
    
  ### Connect a virtual cluster to the platform using a shared access key

    <Flow>
      <Step title="Create the access key">
        
        Log in to vCluster platform. In the platform console, create an [access key](/platform/next/api/authentication). 
        
      </Step>

      <Step title="Assign the vCluster role">

        When creating the access key, you must define the `vcluster` role in the API key YAML specification in the platform console:

        ```yaml title="Role specification"
        spec:
          scope:
            roles:
              - role: vcluster
            projects:
              - project: '*'
          allowLoftCli: true
        type: User
        status: {}
        ```

        :::note
        Assigning the `vcluster` role is required. Without it, the vCluster cannot authenticate with the platform and connection errors occur.
        :::

      </Step>
      <Step title="Create the Secret">
        
        Create the `vcluster-platform-api-key` secret in a namespace on the host cluster: 
        
        :::note
        This namespace does **not** need to match the target namespace used by the virtual cluster, but it must exist on the host where the vCluster is deployed.
        :::

        - Replace `ACCESS_KEY` with your API key, also referred to as the access key.
        - Replace `PLATFORM_HOST` with the platform URL.
        - Replace `SECRET_NAMESPACE` with the namespace where you want to store the Secret.

       ```bash title="Create Secret"
       <InterpolatedCodeBlock
          code={`kubectl create secret generic [[VAR:SECRET_NAME:vcluster-platform-api-key]] \\
          --from-literal=accessKey=[[VAR:ACCESS_KEY:YOUR_ACCESS_KEY]] \\
          --from-literal=host=[[VAR:PLATFORM_HOST:YOUR_PLATFORM_HOST]] \\
          -n [[VAR:SECRET_NAMESPACE:SECRET_NAMESPACE]]`}
          language="bash"
          title="Create Secret"
        />

      </Step>
      
      <Step title="Reference the Secret in vcluster.yaml">
        
        In your `vcluster.yaml` file, reference the Secret by namespace and enable RBAC creation:
        
        <!-- vale off -->
        <InterpolatedCodeBlock
          code={
          `external:
            platform:
            apiKey:
              secretName: [[VAR:SECRET_NAME:vcluster-platform-api-key]]
              namespace: [[VAR:NAMESPACE:vcluster-namespace]]
              createRBAC: [[VAR:CREATE_RBAC:true]]
        `}
          language="yaml"
        />
        - `secretName`: Specifies the name of the Secret containing the API key. Defaults to `vcluster-platform-api-key` if undefined.
        - `namespace`: Specifies the namespace where the Secret is located. If different from the virtual cluster's namespace, ensure that the virtual cluster has access to this namespace.
        - `createRBAC`: When set to `true`, vCluster automatically creates the necessary `Role` and `RoleBinding` resources to allow access to the Secret. Defaults to true.
      </Step>
    </Flow>
  </TabItem>
  
  <TabItem value="individual" label="Individual user access">

  ### Prerequisites

  Before you begin, ensure you have: 

  - Access to the vCluster Platform console.
  - The vCluster CLI or another compatible Kubernetes client (for example vcluster, kubectl, or the Loft CLI) installed on your local machine.
  - The ability for each user to generate their own access key from the Platform UI.
  - Access to edit or create a `vcluster.yaml` file for your virtual cluster configuration.
    
  ### Connect a virtual cluster to the platform using a individual user access

  <Flow>
    <Step title="Locate or Create the vcluster.yaml File">

    You must configure `vcluster.yaml` to define how your virtual cluster connects to the platform.

    - If you are creating a new virtual cluster, create a new `vcluster.yaml` file in your working directory.
    - If you are modifying an existing virtual cluster, locate the `vcluster.yaml` file used during its deployment.

    :::note
    The `vcluster.yaml` file is typically stored locally in your project folder or provided as part of the Helm configuration used to deploy the virtual cluster.
    :::

    </Step>

    <Step title="Configure vcluster.yaml for Individual User Access">

    Update your `vcluster.yaml` file to enable individual user authentication:

    ```yaml title="vcluster.yaml"
    external:
      platform:
        userBased: true
    ```

    :::note
    This configuration requires each user to authenticate with their personal access key instead of creating a shared Kubernetes Secret.
    :::
    </Step>

    <Step title="Generate a Personal Access Key">

    Each user must:

      1. Log in to the vCluster Platform console.
      2. Navigate to the **Access Keys** section.
      3. Create a new personal access key.
      4. Copy and securely store the access key.

    :::note
    Access keys are only displayed once during creation. Ensure users save their keys securely.
    :::

    </Step>

    <Step title="Connect to the virtual cluster">

    Each user can connect to the virtual cluster by using their personal access key through the CLI.

      <!-- vale off -->
      <InterpolatedCodeBlock
        code={`vcluster connect [[VAR:VCLUSTER_NAME:vcluster-name]] \\
        --project [[VAR:PROJECT_NAME:project-name]] \\
        --platform [[VAR:PLATFORM_URL:your-platform-url]] \\
        --access-key [[VAR:ACCESS_KEY:your-personal-access-key]]`}
        language="bash"
        title="Connect to vCluster"
      />
      <!-- vale on -->
    </Step>
  </Flow>
 </TabItem>
</Tabs>


## Example

````mdx
<Tabs>
  <TabItem value="shared" label="Shared access key" default>

    ```yaml title="Shared access key example"
    external:
      platform:
        apiKey:
          secretName: vcluster-platform-api-key  # Defaults to vcluster-platform-api-key if undefined
          namespace: vcluster-namespace  # Namespace to search for the secret. If undefined, it searches the vCluster namespace. If different, vCluster needs access to the target namespace.
          createRBAC: true  # Defaults to true. Automatically creates the necessary RBAC roles and role bindings to locate the secret.
    ````
  </TabItem>

  <TabItem value="individual" label="Individual user access">

    ```yaml title="Individual user access example"
    external:
      platform:
        userBased: true
    ```

  </TabItem>
</Tabs>
```


## Config reference

<ApiKey />
