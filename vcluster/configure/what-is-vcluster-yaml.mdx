---
title: What is vcluster.yaml?
sidebar_label: What is vcluster.yaml?
sidebar_position: 1
description: Introduction to the vcluster.yaml configuration file
---

Every virtual cluster needs configuration settings that define how it operates within your host Kubernetes cluster. The `vcluster.yaml` file serves as the central configuration source for these settings. This file controls everything from the control plane architecture to resource synchronization behavior between the virtual and host clusters.

When you deploy a virtual cluster, the vCluster CLI reads this configuration file and applies your specified settings. The file remains optional - if you don't provide one, vCluster applies sensible defaults that work for most use cases. However, most production deployments benefit from custom configuration to match specific requirements.

Configuration files provide several advantages over command-line flags or scattered settings:

- **Unified configuration**: Instead of managing settings across multiple locations, you maintain all vCluster configuration in a single file.

- **Schema validation**: The vCluster CLI validates your configuration against a predefined schema before deployment. This validation catches errors early and prevents misconfiguration issues that might cause runtime problems.

- **IDE support:** Modern IDEs recognize the vCluster schema and provide autocompletion as you type. The IDE also highlights configuration errors in real-time.

## vcluster.yaml configuration structure

The `vcluster.yaml` file organizes configuration into logical sections. Each section controls a specific aspect of virtual cluster behavior. 

### Control plane settings

The control plane section defines how vCluster runs its Kubernetes API server, controller manager, and data storage. Key configuration areas include:

- **Backing store selection**: Choose between different storage backends for the vCluster control plane's [backing store](./vcluster-yaml/control-plane/components/backing-store/). Options include embedded databases, external databases, or the host cluster's API server.

- **Deployment settings**: Configure how the control plane pods deploy, including resource limits, node selectors, and affinity rules.

- **Networking options**: Define how external traffic reaches the virtual cluster's API server, including ingress configuration and service exposure methods.

### Resource sync rules

Virtual clusters need to share certain resources with their host cluster to function properly. The sync configuration controls this sharing in both directions:

- **From host to virtual**: Configure which host cluster resources appear inside the virtual cluster through [host-to-virtual synchronization](/vcluster/configure/vcluster-yaml/sync/from-host/). Common examples include nodes, storage classes, and priority classes.

- **From virtual to host**: Define which virtual cluster resources sync to the host cluster through [virtual-to-host synchronization](/vcluster/configure/vcluster-yaml/sync/to-host/). This typically includes pods, services, and persistent volume claims that need to run on the host.

### Access configuration

The access configuration determines how users and apps connect to the virtual cluster:

- **The kubeconfig file generation:** Configure how vCluster generates and stores [kubeconfig files](/vcluster/configure/vcluster-yaml/export-kube-config) for accessing the virtual cluster. This includes secret names, context names, and server URLs.

- **Authentication methods:** Define authentication mechanisms and certificate settings for secure access.

## Example configuration

This example demonstrates a common configuration and explains each section's purpose:

```yaml
# Control plane configuration
controlPlane:
  # Configure the backing store for vCluster's data
  backingStore: # Pro feature - requires license
    etcd:
      embedded: 
        enabled: true  # Run etcd inside the vCluster pod
  
  # Expose the API server via ingress
  ingress:
    enabled: true
    host: vcluster-k8s-api.example.com  # Your API server hostname

# Resource synchronization settings
sync:
  # Resources that sync from virtual cluster to host
  toHost:
    serviceAccounts:
      enabled: true  # Sync ServiceAccounts for operators/controllers
  
  # Resources that sync from host to virtual cluster  
  fromHost:
    nodes:
      enabled: true  # Sync real nodes instead of fake nodes
      clearImageStatus: true  # Remove image data to save resources

# Kubeconfig export configuration
exportKubeConfig:
  context: my-vcluster-context  # Name in the kubeconfig file
  server: https://vcluster-k8s-api.example.com  # API server URL
  secret:
    name: my-vcluster-kubeconfig  # Secret name for storing kubeconfig
```

### How each setting works

Each configuration section serves a specific purpose in the virtual cluster setup:

- **Control plane with embedded storage:** The configuration uses [embedded etcd](/vcluster/configure/vcluster-yaml/control-plane/components/backing-store/etcd/embedded) as the data store for the virtual cluster's control plane. This approach reduces operational complexity because etcd runs inside the vCluster pod rather than requiring a separate database. Note that this feature requires a Pro license.

- **API server exposure:** An [Ingress](/vcluster/configure/vcluster-yaml/control-plane/deployment/ingress) resource exposes the virtual cluster's API server through a hostname. This setup allows external tools and users to access the virtual cluster without port-forwarding or NodePort services.

- **ServiceAccount synchronization:** The configuration enables [ServiceAccount](/vcluster/configure/vcluster-yaml/sync/to-host/advanced/service-accounts) syncing from the virtual cluster to the host. This synchronization supports workloads that need specific permissions on the host cluster, such as operators or controllers that manage host resources.

- **Real node synchronization:** Instead of using vCluster's default "pseudo" nodes, this configuration syncs real [node](/vcluster/configure/vcluster-yaml/sync/from-host/nodes) information from the host cluster. The `clearImageStatus` option removes image information from synced nodes to reduce data transfer and storage requirements.

5. **Kubeconfig access:** The configuration defines how vCluster exports the [kubeconfig](/vcluster/configure/vcluster-yaml/export-kube-config) for accessing the virtual cluster. The exported kubeconfig gets stored in a Kubernetes secret, making it available for CI/CD pipelines, ArgoCD apps, or Terraform configurations.

## Practical usage

The configuration file integrates with various vCluster operations throughout the virtual cluster lifecycle.

### Create a new virtual cluster

When you create a virtual cluster, the vCluster CLI reads your configuration file and applies all settings during deployment:

1. Write your configuration options in a file named `vcluster.yaml`
2. Run the deployment command with your configuration file
3. vCluster validates the configuration and creates the virtual cluster with your specified settings

For detailed deployment instructions, see the [deployment guide](../deploy/basics/).

### Update existing virtual clusters

Configuration changes often become necessary as requirements evolve. vCluster supports updating existing virtual clusters with new configuration:

1. Edit your `vcluster.yaml` file with the desired changes
2. Apply the updated configuration to your existing virtual cluster
3. vCluster reconciles the differences and updates the deployment

The [deploy changes guide](../manage/deploy-changes/) provides complete instructions for updating virtual cluster configuration.

## Frequently asked questions

### How do I migrate from vCluster 0.19.x?

vCluster v0.20 introduces a completely new configuration format that replaces the previous system. The old approach used a combination of:
- CLI flags passed during creation
- Helm values in various `values.yaml` files
- Annotations on resources
- Different configuration formats for each distribution

The new unified `vcluster.yaml` format consolidates all these settings into a single, consistent structure. Your existing 0.19.x configuration files won't work with v0.20, so migration requires converting to the new format.

The [conversion guide](/vcluster/reference/migrations/0-20-migration) walks through the migration process step by step, including:
- Mapping old settings to new configuration options
- Handling distribution-specific configurations
- Validating the converted configuration

:::warning
Pre-v0.20.0 `values.yaml` files don't work with v0.20.0. Convert to the new format before using the new vCluster CLI or upgrading existing instances.
:::

### Do I need a vcluster.yaml file?

A configuration file remains optional for vCluster deployments. When you create a virtual cluster without providing a `vcluster.yaml` file, vCluster applies default settings that:
- Use the host cluster as the backing store
- Sync essential resources like pods and services
- Configure basic networking with ClusterIP services
- Set up standard authentication and access controls

These defaults work well for development environments and simple use cases. However, production deployments typically need custom configuration for security, performance, and integration requirements.

### Can I update existing virtual clusters?

Yes, vCluster supports configuration updates for existing virtual clusters. The update process preserves your virtual cluster's state while applying new configuration:

```bash
vcluster create VCLUSTER_NAME --upgrade -f vcluster.yaml
```

This command:
1. Reads your updated configuration file
2. Compares it with the current configuration
3. Applies only the changed settings
4. Performs a rolling update if needed

Some configuration changes require pod restarts, while others apply immediately. The vCluster CLI handles these details automatically during the upgrade process.
