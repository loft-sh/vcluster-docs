---
title: Manage vCluster Standalone Control Plane Nodes
sidebar_label: Manage
sidebar_position: 3
sidebar_class_name: standalone private-nodes
---
import Flow, { Step } from "@site/src/components/Flow";

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import TenancySupport from '../../../_fragments/tenancy-support.mdx';

<TenancySupport standalone="true"/>

## Update vCluster Standalone configuration

Changing the `vcluster.yaml` configuration has to be done on all control plane nodes.

<Flow>
  <Step>
    Modify the `vcluster.yaml`.

    The `vcluster.yaml` is located at: `/var/lib/vcluster/config.yaml`. Edit and save your changes.
  </Step>
  <Step>
    Restart vCluster systemD service to deploy your changes.

    ```bash title="Restart vCluster"
    systemctl restart vcluster.service
    ```

  </Step>
</Flow>

## Remove vCluster

### Control plane only nodes

If you have not enabled joining the control plane nodes as worker nodes, then removing vCluster
is stopping the service and removing files from the nodes. For HA clusters, there are additional steps.

For control plane nodes that are joined in the cluster (`controlPlane.standalone.joinNode.enabled: true`), please first make sure you follow this processes [worker node removal steps](../../worker-nodes/private-nodes/manage/#remove-worker-node) and [node cleanup](../../worker-nodes/private-nodes/manage/#clean-up-orphaned-node)

<br/>
<br/>
<Tabs
  groupId="deploy"
  defaultValue="single"
  values={[
    { label: "Single Control Plane Node", value: "single" },
    { label: 'Multiple Control Plane Nodes (HA)', value: 'HA' },
  ]
  }>
  <TabItem value="single">
    <Flow>
      <Step>
        Stop the vCluster service on the control plane node.

        ```bash title="Stop vCluster service"
        systemctl stop vcluster.service
        ```
      </Step>
      <Step>
        Remove vCluster files on the control plane node.

        ```bash title="Clean up vCluster files"
        rm -rf /var/lib/vcluster && rm /etc/systemd/system/vcluster.service
        ```
      </Step>
    </Flow>
  </TabItem>
  <TabItem value="HA">
    <Flow>
      <Step>
        Save the IP Address of the node you want to remove, it will be needed later.
        There are multiple ways to check it, but if you're unsure, you can get it from the vcluster logs:

        ```bash title="Get etcd peer ip"
        journalctl -u vcluster.service | grep etcd | grep "Adding peer"
        INFO        etcd/add.go:48        Adding peer https://10.244.0.28:2380
        ```

        Stop the vCluster service on the control plane node.

        ```bash title="Stop vCluster service"
        systemctl stop vcluster.service
        ```
      </Step>
      <Step>
        Remove vCluster files on the control plane node.

        ```bash title="Clean up vCluster files"
        rm -rf /var/lib/vcluster && rm /etc/systemd/system/vcluster.service
        ```
      </Step>
      <Step>
        On the different node, list existing etcd cluster members:
        ```bash title="List ETCD members"
        /var/lib/vcluster/bin/etcdctl --endpoints=127.0.0.1:2379 --cert=/var/lib/vcluster/pki/apiserver-etcd-client.crt --key=/var/lib/vcluster/pki/apiserver-etcd-client.key --cacert=/var/lib/vcluster/pki/etcd/ca.crt member list
        ```

        find a peer ID (first column) in the output that matches your removed node IP saved earlier (`https://10.244.0.28:2380`):
        ```bash title="List ETCD members output"
        8f2bcb8fdb98bd92, started, 10.244.0.26, https://10.244.0.26:2380, https://10.244.0.26:2379, false
        d12398ad344dc8cf, started, 10.244.0.29, https://10.244.0.29:2380, https://10.244.0.29:2379, false
        ee33f76261ecb3b3, started, 10.244.0.28, https://10.244.0.28:2380, https://10.244.0.28:2379, false
        ```

        matching peer ID is `ee33f76261ecb3b3`.

        then, remove etcd peer:

        ```bash title="Remove ETCD peer"
        /var/lib/vcluster/bin/etcdctl --endpoints=127.0.0.1:2379 --cert=/var/lib/vcluster/pki/apiserver-etcd-client.crt --key=/var/lib/vcluster/pki/apiserver-etcd-client.key --cacert=/var/lib/vcluster/pki/etcd/ca.crt member remove ee33f76261ecb3b3
        ```

      </Step>
    </Flow>
  </TabItem>

</Tabs>
