import CodeBlock from '@theme/CodeBlock';

## Use selectors to filter

Selectors provide precise control over which {props.resourceClass} resources get synced from the host cluster and which {props.resource} {props.showExtraResource && (<> and {props.extraResource} </>)}resources gets synced to the host cluster. vCluster supports two types of selector criteria that follow standard [Kubernetes label selector syntax](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#resources-that-support-set-based-requirements).

<!-- vale off -->
### Filter with matchLabels
<!-- vale on -->

The `matchLabels` selector defines **exact** label key-value pairs that must be present on an {props.resourceClass} for it to be synced. This provides straightforward filtering based on specific labels.

The following example syncs only {props.resourceClass} resources with a `environment: development` label:

{props.showResource && (<>

<CodeBlock language="yaml" title="Example with matchLabels">
{`sync:
    toHost:
      ${props.pluralResource}:
        enabled: true
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchLabels:
            environment: development`}
</CodeBlock>
 </>)}


{!props.showExtraResource && !props.showResource && (<>

<CodeBlock language="yaml" title="Example with matchLabels">
{`sync:
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchLabels:
            environment: development`}
</CodeBlock>
 </>)}

 {props.showExtraResource && (<>

<CodeBlock language="yaml" title="Example with matchLabels">
{`sync:
    toHost:
      ${props.pluralResource}:
        enabled: true
      ${props.pluralExtraResource}:
        enabled: true
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchLabels:
            environment: development`}
</CodeBlock>
 </>)}

<!-- vale off -->
### Filter with matchExpressions
<!-- vale on -->

The `matchExpressions` selector allows more flexible, set-based filtering with support for multiple operators:

- `In`: Select all resources that has a specific key and the value is in the set of values
- `NotIn`: Select all resources that has a specific key and the value is not in the set of values
- `Exists`: Select all resources including a label with the key; no values are checked
- `DoesNotExist`: Select all resources without a label with the key; no values are checked

The following example syncs {props.resourceClass} resources where the key of the label is <code>{props.expressionKey}</code> and the value of that label is either <code>{props.expressionValue1}</code> or <code>{props.expressionValue2}</code>:

{!props.showExtraResource && !props.showResource && (<>

<CodeBlock language="yaml" title="Example with matchExpressions">
{`sync:
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchExpressions:
            - key: ${props.expressionKey}
              operator: In
              values:
                - ${props.expressionValue1}
                - ${props.expressionValue2}`}
</CodeBlock>

</>)}

{props.showResource && (<>

<CodeBlock language="yaml" title="Example with matchExpressions">
{`sync:
    toHost:
      ${props.pluralResource}:
        enabled: true
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchExpressions:
            - key: ${props.expressionKey}
              operator: In
              values:
                - ${props.expressionValue1}
                - ${props.expressionValue2}`}
</CodeBlock>

</>)}

{props.showExtraResource && (<>

<CodeBlock language="yaml" title="Example with matchExpressions">
{`sync:
    toHost:
      ${props.pluralResource}:
        enabled: true
      ${props.pluralExtraResource}:
        enabled: true
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchExpressions:
            - key: ${props.expressionKey}
              operator: In
              values:
                - ${props.expressionValue1}
                - ${props.expressionValue2}`}
</CodeBlock>

</>)}

### Combined filter criteria

Label conditions are additive meaning all specified label conditions must match for the {props.resourceClass} resource to be selected to be synced. This means that if you define multiple `matchLabels` and `matchExpressions`, the {props.resourceClass} resource must satisfy all criteria to be synced to the virtual cluster.

The following example syncs {props.resourceClass} resources that match both label and expression criteria:

{!props.showExtraResource && !props.showResource && (<>

<CodeBlock language="yaml" title="Example with matchLabels and matchExpressions">
{`sync:
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchLabels:
            environment: development
          matchExpressions:
            - key: ${props.expressionKey}
              operator: In
              values:
                - ${props.expressionValue1}
                - ${props.expressionValue2}`}
</CodeBlock>

</>)}

{props.showResource && (<>

<CodeBlock language="yaml" title="Example with matchLabels and matchExpressions">
{`sync:
    toHost:
      ${props.pluralResource}:
        enabled: true
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchLabels:
            environment: development
          matchExpressions:
            - key: ${props.expressionKey}
              operator: In
              values:
                - ${props.expressionValue1}
                - ${props.expressionValue2}`}
</CodeBlock>

</>)}

{props.showExtraResource && (<>

<CodeBlock language="yaml" title="Example with matchLabels and matchExpressions">
{`sync:
    toHost:
      ${props.pluralResource}:
        enabled: true
      ${props.pluralExtraResource}:
        enabled: true
    fromHost:
      ${props.pluralResourceClass}:
        enabled: true
        selector:
          matchLabels:
            environment: development
          matchExpressions:
            - key: ${props.expressionKey}
              operator: In
              values:
                - ${props.expressionValue1}
                - ${props.expressionValue2}`}
</CodeBlock>

</>)}

In this example, the {props.resourceClass} must have the following labels to sync to the virtual cluster:

* `environment: development`
* Either <code>{props.expressionKey}:{props.expressionValue1}</code> or <code>{props.expressionKey}:{props.expressionValue2}</code>
