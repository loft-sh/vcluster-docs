import CodeBlock from '@theme/CodeBlock';
import EnableSyncing from '@site/vcluster/_fragments/sync/class-syncing-enable.mdx';
import HowSyncingWorks from '@site/vcluster/_fragments/sync/class-syncing-how-it-works.mdx';
import UseSelectors from '@site/vcluster/_fragments/sync/class-syncing-selectors.mdx';

<!-- vale off -->
<EnableSyncing {...props} />

<HowSyncingWorks {...props} />

<UseSelectors {...props} />
<!-- vale on -->

## Sync behavior considerations

### Resource lifecycle

Synced {props.resourceClass} resources function like any other Kubernetes resource in the virtual cluster. You
can view them with <code>kubectl get {props.lowercaseResourceClass}</code> and reference them in your {props.resource} {props.showExtraResource && (<> and {props.extraResource} </>)}resource
specifications with the <code>{props.resourceClassName}</code> field.

When you modify the {props.resourceClass} resource in the host cluster, vCluster re-evaluates whether it still matches the selector criteria. If the {props.resourceClass} continues to match, vCluster updates the corresponding resource in the virtual cluster to reflect the changes. If the {props.resourceClass} no longer matches the selector criteria, vCluster removes it from the virtual cluster.

The selector system acts as both a resource filter and a validation mechanism. As a resource filter, it
ensures that vCluster creates only {props.resourceClass} resources matching the defined selector criteria. The selector also functions as a creation validation mechanism - when you create {props.resource} {props.showExtraResource && (<> and {props.extraResource} </>)}resources in the virtual cluster, the resources can only reference {props.resourceClass} resources that exist in the virtual cluster.

### Orphaned resources

When vCluster removes a synced {props.resourceClass} from the virtual cluster due to selector changes or deletion from the host cluster,
any {props.resource} {props.showExtraResource && (<> and {props.extraResource} </>)}resources that reference it remain in the virtual and host clusters. These orphaned {props.resource} {props.showExtraResource && (<> and {props.extraResource} </>)}resources stop
receiving updates but vCluster does not automatically delete them to prevent unintended data loss.
 To remove these orphaned resources, you must delete them manually in the virtual and host clusters. This manual approach ensures that you maintain full control over resource cleanup and can verify that deletions are intentional.

### Error handling and troubleshooting

When the {props.resourceClass} resource doesn't match the selector criteria during evaluation, vCluster logs a warning in the syncer pod's output to help with troubleshooting and monitoring. This logging provides visibility into which resources are being filtered out and why.

When you creates the {props.resource} {props.showExtraResource && (<> or {props.extraResource} </>)}resource that references a {props.resourceClass} not matching the selector criteria, several things occur to provide clear feedback:

- The {props.resource} {props.showExtraResource && (<> or {props.extraResource} </>)}fails to sync to the host cluster
- vCluster records an event on the {props.resource} {props.showExtraResource && (<> or {props.extraResource} </>)}resource in the virtual cluster
- The event indicates that the specified {props.resourceClass} is not available according to the current selector configuration

The error output appears as a Kubernetes event that you can view using `kubectl describe`. The event message clearly states that the {props.resource} {props.showExtraResource && (<> or {props.extraResource} </>)}resource was not synced because the referenced {props.resourceClass} does not match the defined selector criteria.

The error output looks like this:

<CodeBlock language="bash" title="Example error handling output">
{`vcluster-virtual-cluster-1:~$ kubectl describe ${props.lowercaseResource} my-${props.lowercaseResource}
Name:                       my-${props.lowercaseResource}
Namespace:                  default
${props.resourceClass}:     ${props.expressionValue2}
Events:
    Type     Reason            Age   From                   Message
    ----     ------            ----  ----                    -------
    Warning  SyncWarning       10s   ${props.lowercaseResource}-syncer      did not sync ${props.lowercaseResource} "my-${props.lowercaseResource}" to host because it does not match the selector under 'sync.fromHost.${props.pluralResourceClass}.selector'`}
</CodeBlock>
