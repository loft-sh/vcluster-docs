---
title: Persisting vCluster data
sidebar_label: Persisting vCluster data
sidebar_position: 3
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

vCluster allows you to use either etcd or RDBS via KINE as a backend. This feature provides flexibility to vCluster operators. The available datastore options allow you to select a datastore that best fits your use case.

vCluster supports the following datastore options:
* [Embedded SQLite](https://www.sqlite.org/index.html) (default with Persistent Volume)
* [PostgreSQL](https://www.postgresql.org/)
* [MySQL](https://www.mysql.com/)
* [MariaDB](https://mariadb.org/)
* [etcd](https://etcd.io/)

## Embedded SQLite without Persistent Volume

By default vCluster wil use a persistent volume claim to store the data in. You can also instead use an [emptyDir](https://kubernetes.io/docs/concepts/storage/volumes/#emptydir) to store the virtual cluster data.

In order to use an emptyDir to store the data instead of a persistent volume, please create a `values.yaml` with the following contents:

```yaml
controlPlane:
  statefulSet:
    persistence:
      volumeClaim:
        enabled: true
```

Then upgrade or recreate the vCluster with:

```
vcluster create my-vcluster -n my-vcluster --upgrade -f values.yaml
```

:::warning Potential Data Loss
This method should only be used for testing purposes, as data will be lost upon pod recreation.
:::

## Configuration & Examples

<Tabs
    defaultValue="embedded-sqlite"
    values={[
        { label: 'Embedded SQLite', value: 'embedded-sqlite', },
        { label: 'Embedded Etcd', value: 'embedded-etcd', },
        { label: 'Deployed Etcd', value: 'deployed-etcd', },
        { label: 'MySQL / MariaDB', value: 'mysql', },
        { label: 'Postgresql', value: 'postgresql', },
    ]}>
<TabItem value="embedded-sqlite">

This is the default, so you don't need to configure anything. If you want to explicitly set this option, you can use:
```yaml
controlPlane:
  backingStore:
    database:
      embedded:
        enabled: true
```

</TabItem>
<TabItem value="embedded-etcd">

This is a pro only feature, but allows you to deploy etcd within each vCluster that allows you to use HA (which embedded SQLite doesn't allow):
```yaml
controlPlane:
  backingStore:
    etcd:
      embedded:
        enabled: true
```

</TabItem>
<TabItem value="deployed-etcd">

This will deploy an etcd instance alongside vCluster that is used as a backing store:
```yaml
controlPlane:
  backingStore:
    etcd:
      deploy:
        enabled: true
```

</TabItem>
<TabItem value="mysql">

In its most common form, the option for MySQL and MariaDB has the following format:

```yaml
controlPlane:
  backingStore:
    database:
      external:
        enabled: true
        dataSource: mysql://username:password@tcp(hostname:3306)/database-name
```

If you specify a database name and it does not exist, the server will attempt to create it.

</TabItem>
<TabItem value="postgresql">

In its most common form, the option for PostgreSQL has the following format:

```yaml
controlPlane:
  backingStore:
    database:
      external:
        enabled: true
        dataSource: postgres://username:password@hostname:port/database-name
```

More advanced configuration parameters are available. For more information on these, please see https://godoc.org/github.com/lib/pq.

If you specify a database name and it does not exist, the server will attempt to create it.

</TabItem>
</Tabs>

### Postgres Example

The following example could be used to launch a vCluster that connects to a PostgresSQL database named vcluster. Create a `values.yaml` with:

```yaml
controlPlane:
  backingStore:
    database:
      external:
        enabled: true
        dataSource: postgres://username:password@hostname:5432/vcluster
```

Create the vCluster with:
```
vcluster create my-vcluster -n my-vcluster -f values.yaml
```

### MySQL Example

The following example could be used to connect the vCluster to a MySQL database named vcluster. Create a `values.yaml` with:

```yaml
controlPlane:
  backingStore:
    database:
      external:
        enabled: true
        dataSource: mysql://username:password@tcp(hostname:3306)/vcluster
```

Create the vCluster with:
```
vcluster create my-vcluster -n my-vcluster -f values.yaml
```
