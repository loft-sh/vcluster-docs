import Flow, { Step } from '@site/src/components/Flow';

#### OCI configuration options

| Option  | Description  |
|---|---|
| `auto.storage.type.oci.repository` | OCI registry address. Must be pre-fixed with `oci://` |
| `auto.storage.type.oci.credential` | Reference the OCI credentials as a Kubernetes secret |
| `auto.storage.type.oci.credential.name` | Name of the Kubernetes secret |
| `auto.storage.type.oci.credential.namespace` | Namespace of the Kubernetes secret. The secret must be deployed on the host of where the vCluster control plane pod is deployed to.  |
| `auto.storage.type.oci.username` | Username of the credentials to access the OCI registry |
| `auto.storage.type.oci.password` | Password of the credentials to access the OCI registry |

#### Authenticate with credentials in a Kubernetes secret

It's recommended to store your credentials to your OCI registry in a secret and reference the secret in the `vcluster.yaml` of your virtual cluster configuration. This protects the details of your credentials.

<Flow>
<Step>
  Create a Kubernetes secret of your credentials to your OCI registry.

  Create this secret on the host of where the vCluster control plane is deployed. It could be deployed in the namespace
  of the vCluster or a different namespace. If the vCluster is externally deployed, ensure the vCluster ClusterRole has permission to read the secret. The vCluster ClusterRole follows the naming pattern `vc-<vClusterName>-v-<vClusterNamespace>`.

  The secret needs to contain:
  * `username`
  * `password`

  ```bash title="Create OCI credentials secret"
  kubectl create -f - <<EOF
  apiVersion: v1
  kind: Secret
  type: Opaque
  metadata:
    name: oci-cred
    namespace: p-default
  data:
    username: "id" # username to authenticate with the OCI registry
    password: "key" # password base64 to authenticate with the OCI registry
  EOF
  ```
</Step>

<Step>
  Create a vCluster referencing those credentials.

  ```yaml title="Example vcluster.yaml referencing the Kubernetes secret"
  snapshots:
    auto:
      # Take a snapshot every 12 hours
      schedule: 0 */12 * * *
      storage:
        type: oci
        oci:
          # Location of OCI registry
          # Must be prefixed with `oci://`
          repository: oci://my-registry/snapshots
          credential:
            secretName: oci-cred
            secretNamespace: p-default
  ```
</Step>
</Flow>

#### Authenticate without a Kubernetes secret

If you do not want to use a secret, you can also explicitly set the `username` and `password`
 directly in the `vcluster.yaml`.

```yaml title="Example vcluster.yaml setting OCI credentials without a secret"
snapshots:
  auto:
    # Take a snapshot every 12 hours
    schedule: 0 */12 * * *
    storage:
      type: oci
      oci:
        # Location of OCI registry
        # Must be prefixed with `oci://`
        repository: oci://my-registry/snapshots
        credential:
          username: "my-username"
          password: "my-pasword"
```
